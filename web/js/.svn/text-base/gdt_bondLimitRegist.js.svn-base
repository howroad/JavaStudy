// 债券额度的注册登记页面 

/**
 * 加载页面时，标记被驳回的数据
 */
$(function(obj) {
	var rowList = $("input[id$=._check]:visible");
	if (rowList != null && rowList.length > 0) {
		for ( var i = 0; i < rowList.length; i++) {
			var tr = nstc.sf.findParent(rowList[i], "TR");
			var rejectReason = $(tr).find("[id$=.approveNote]").val();
			if (rejectReason != null && rejectReason != '') {
				$(tr).css("background-color", "#FFC0CB");
			}
		}
	}
});

// 查询操作
function doQuery(obj){
	var minAmount = $('input[id$=.minAmount]').val();
	var maxAmount = $('input[id$=.maxAmount]').val();
	var minDate = $('input[id$=.minDate]').val();
	var maxDate = $('input[id$=.maxDate]').val();
	if(!compareAmount(minAmount, maxAmount, '注册额度范围不合理')){
		return;
	} 
	if(!compareDate(minDate, maxDate, '登记日期范围不合理')){
		return;
	}
	smartForm_doRefresh(obj)
}


// 选择单位
function selectNsClient(){
	var url = 'GDEBIT@gdt_nsClientSlt.sf';
	openwin(url, '单位列表', 500, 400);
}
function setNsclient(obj){
	$("input[id$=.cltNo]").val(obj.cltNo);
	$("input[id$=.cltName]").val(obj.cltName);
}

// 添加按钮,弹出登记窗口
function doAdd(){
	var url = 'GDEBIT@gdt_bondlimit_register.sf?m=a';
	openwin(url, '债券额度录入', 900, 600);
}

// 提交按钮,提交债券额度录入
function doSubmit(obj){
	var checkNum=getCheckNum();
	if (checkNum == 0) {
		alert("至少选择一条记录！");
		return;
	}
	smartForm_doSave(obj);
}

// 删除按钮, 删除债券额度录入
function doDelete(obj){
	var checkNum=getCheckNum();
	if (checkNum == 0) {
		alert("至少选择一条记录！");
		return;
	}
	if(confirm("确认删除？")){
		smartForm_doSave(obj);
	}
}

// 获取选中的行
function getCheckNum(){
	var checkObj = $("[id$=._check]:visible");
	var checkNum = 0;
	for ( var i = 0; i < checkObj.length; i++) {
		if (checkObj[i].checked) {
			checkNum++;
		}
	}
	return checkNum;
}

// 全选
function checkAll(obj){
	smartForm_all_checkbox(obj,'gdt_bondLimitRegist_list._check');
	getCheckSize();
}

// 选择某一个
function checkRec(obj){
	nstc.sf.clickCheckbox(obj);
	getCheckSize();
}


function getCheckSize(){
	var selectRecords = $("[id$=selectRecords]").val();
	var checkNum=getCheckNum();
	var selectRecordsHtml  = '<input id="selectRecords" name="selectRecords" type="hidden" value="'+selectRecords+'"/>'
	$("[id$=selectRecords]").parent().html("共计"+selectRecords+"笔，已选"+checkNum+"笔。"+selectRecordsHtml);
}

//查看融资申请操作
function showBondissue(obj){
//	var tr = nstc.sf.findParent(obj, 'tr');
//	var bondissueId = $(tr).find('input[id$=.bondissueId]').val();
	var url = 'GDEBIT@gdt_bondlimit_register.sf?m=v&bondissueId='+obj;
	openwin(url, '债券额度录入', 1200, 600);
}

// 修改融资申请操作
function modifyBondissue(obj){
//	var tr = nstc.sf.findParent(obj, 'tr');
//	var bondissueId = $(tr).find('input[id$=.bondissueId]').val();
	var url = 'GDEBIT@gdt_bondlimit_register.sf?m=e&bondissueId='+obj;
	openwin(url, '债券额度录入', 1200, 600);
}