$(function (){
	//动态显示授信品种
	var bussClass = document.getElementById('gdt_contractAmendment_qry.bussClass');
	var bussVariety = document.getElementById('gdt_contractAmendment_qry.bussVariety');
	queryBussVares(bussClass,bussVariety);
})

//展示合同
function showContract(obj){
	var tr = nstc.sf.findParent(obj, 'tr');
	var bussVariety = $(tr).find('input[id$=.bussVariety]').val();
	var contractId = $(tr).find('input[id$=.contractId]').val();
	doSelAmendment(bussVariety,contractId);
}


//进入修正待处理页面
function showAmeWait(){
	location.href = "GDEBIT@gdt_contractAmeWait.sf?m=e";
}


//查询操作
function doQuery(obj){
	var minAmount = $('input[id$=.minAmount]').val();
	var maxAmount = $('input[id$=.maxAmount]').val();
	if(!compareAmount(minAmount, maxAmount, '合同金额范围不合理')){
		return;
	} 
	
	var sFmDate = $('input[id$="minStartDate"]').val();
	var eFmDate = $('input[id$="maxStartDate"]').val();
	if(!compareDate(sFmDate,eFmDate,'开始日日期范围不合理')){
		return;
	}
	
	var sDate = $('input[id$="minEndDate"]').val();
	var eDate = $('input[id$="maxEndDate"]').val();
	if(!compareDate(sDate,eDate,'到期日日期范围不合理')){
		return;
	}
	smartForm_doRefresh(obj)
}

//全选
function checkAll(obj){
	smartForm_all_checkbox(obj,'gdt_contractAmendment_list._check');
	getCheckSize();
}
//获取选中的行
function getCheckNum(){
	var checkObj = $("[id$=._check]:visible");
	var checkNum = 0;
	for ( var i = 0; i < checkObj.length; i++) {
		if (checkObj[i].checked) {
			checkNum++;
		}
	}
	return checkNum;
}
//选择某一个
function checkRec(obj){
	nstc.sf.clickCheckbox(obj);
	getCheckSize();
}
function getCheckSize(){
	var selectRecords = $("[id$=selectRecords]").val();
	var checkNum=getCheckNum();
	var selectRecordsHtml  = '<input id="selectRecords" name="selectRecords" type="hidden" value="'+selectRecords+'"/>'
	$("[id$=selectRecords]").parent().html("共计"+selectRecords+"笔，已选"+checkNum+"笔。"+selectRecordsHtml);
}

//异步加载业务品种
function doChange(obj){
	var bussClass = obj.value;
	$.ajax({
		  type: 'POST',
		  url: "GDEBIT@QueryBussVaresBusiness.sf",
		  async : false,
		  data: {'bussClass':bussClass},
		  dataType:'json',
		  success: function(data) {
			  var bussVar = $("select[id$=.bussVariety]")[0];
			  bussVar.innerHTML = "";
			  if (data.length > 0) {
				  for ( var i = 0; i < data.length; i++) {
					  var name = data[i].name;
					  var value = data[i].value;
					  bussVar[i] = new Option(name, value);
				  }
			  } 
		  },
		  error:function(){
			  alert("业务繁忙!");
		  }
	})
}

//修正操作
function doAmendment(obj){
	var tr = nstc.sf.findParent(obj, 'tr');
	var contractId = $(tr).find('input[id$=.contractId]').val();
	//var fmId = $("input[id$='fmId']").val();
	//校验是否在工作流中
	var result = validateInFlow('GDEBIT_FM003',contractId);
	if(result != '' && result != null && result != undefined){
		alert(result);
		return;
	}
	
	var variety = $(tr).find('input[id$=.bussVariety]').val();
	var fmId = $(tr).find('input[id$=.fmId]').val();
	var m = "e";
	doSelAmendment(variety,null,contractId,m);
}

