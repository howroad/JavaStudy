// 融资申请页面 --> 添加/查看/修改
$(function(){
	var m = document.getElementById('m').value;
	//动态显示授信品种
	var pageCode = $("input[id='pageCode']").val();
	var cltNo = document.getElementById(pageCode + '_info.cltNo');
	var cltName = document.getElementById(pageCode + '_info.cltName');
	var bussClass = document.getElementById(pageCode + '_info.bussClass');
	var bussVariety = document.getElementById(pageCode + '_info.bussVariety');
	
	//保存后加载页面上的业务分类
	if(bussClass != undefined && bussClass.length <=1){
		getBussClass();
	}
	if(m=='a') {
		queryBussVariety(bussClass,bussVariety);
	}

	//m=v模式下显示申请日志
	//m=v模式下显示申请日志
	
	var div = $("div[id$='_log']")[0];
	if(div != undefined && div != null){
		div.style.display = 'none';
	}
	var m = document.getElementById('m').value;
	if(m!=null && m=='v' && div != undefined && div != null){
		div.style.display = '';
	}
	
	//实现删除附件,页面不刷新   
	var tab = $("input[id='"+pageCode+"_info._applyFiles_del']").prev();
	var tBody = tab.find('tbody');
	//获取tBody下面所有的子节点
	tBody.children().each(function(){
		//获取每个tr下的 第二个 td
		var tdObj = $(this).children('td').eq(1);
		//获取每个tr下的 第二个 td 下 的第二个 a 标签
		var aObj = tdObj.children('a').eq(1);
		var href = $(aObj).attr("href");
		//重置href属性,不让页面跳转
		$(aObj).attr("href","javascript:void(0)");
		//添加点解事件
		aObj.click(function(){
			$.ajax({
				type: 'POST',
				url: href,
				async : false,
				dataType: "text",
				success: function(data) {
					//删除成功,删除这一行 tr
					$(aObj).parent().parent().remove();
				}
		  	});  
		});
	})
	
	/*if (m=='a') {
		var variety = $("select[id$='info.bussVariety']").val();
		controlLgmShow(variety);
	} else {
		var variety = $("input[id$='info.bussVariety']").val();
		controlLgmShow(variety);
	}*/
});


/*function controlLgmShow(variety) {
	var bzj = $("div[id$='_lgm']")[0];
	if (variety == 'CLMS26' || variety == 'CLMS05' || variety == 'CLMS06' || 
			variety == 'CLMS07' || variety == 'CLMS08' || variety == 'CLMS09' || 
			variety == 'CLMS12' || variety == 'CLMS13' || variety == 'CLMS14') {
		if (bzj != null && bzj != '') {
			bzj.style.display = '';
		}
	} else {
		if (bzj != null && bzj != '') {
			bzj.style.display = 'none';
		}
	}
}*/

//融资申请保存按钮
function doEntrySave(obj){
	$("[id$=.isApprove]").val("0");
	if(!saveCheck()){
		return ;
	}
	// 附件验证
	if (!attachUploadValidate()) {
		return;
	}
	if (!checkFileUploadControl("001")) {
		return;
	}
	//"预计发行日期"大于等于"申请日期"小于"开始日/起息日"
	var issueDate = $('input[id$=.issueDate]').val();
	if(issueDate != undefined){
		if(!checkSaveDateValite()){
			return;
		}
	}
		
	smartForm_doSave(obj);
}

//提交按钮
function doEntrySubmit(obj){
	$("[id$=.isApprove]").val("1");
	if(!saveCheck()){
		return ;
	}
	// 附件验证
	if (!attachUploadValidate()) {
		return;
	}
	if (!checkFileUploadControl("001")) {
		return;
	}
	//"预计发行日期"大于等于"申请日期"小于"开始日/起息日"
	var issueDate = $('input[id$=.issueDate]').val();
	if(issueDate != undefined){
		if(!checkSaveDateValite()){
			return;
		}
	}
	smartForm_doSave(obj);
}

function checkSaveDateValite(){
	//预计发行日期
	var issueDate = $('input[id$=.issueDate]').val();
	//申请日期
	var applyDate = $('input[id$=.applyDate]').val();
	//"开始日/起息日"
	var startDate = $('input[id$=.startDate]').val();
	//"预计发行日期"大于等于"申请日期"
	if(!compareDate(applyDate,issueDate, '预计发行日期应大于等于申请日期')){
		return false;
	}
	//"预计发行日期"小于"开始日/起息日"
	if(!compareDate(issueDate, startDate, '预计发行日期应小于等于开始日/起息日')){
		return false;
	}

  return true;
}
//授信信息删除按钮
function doDelCredit(obj){
	var list=$('div[id$="_credit"]');
	//var checks=list.find('input[id$="_check"]:checked');
	var checks=$("input[id$='_credit._check']:checked");
	if(checks==undefined || checks.length==0){
		alert("至少选择一条数据");
		return;
	}
	$(checks).each(function(){
		nstc.sf.delCurrRow(this)
	});
}
//中介机构删除按钮
function doDelAgency(obj){
	var list=$('div[id$="_agency"]');
	var checks=list.find('input[id$="_check"]:checked');
	if(checks==undefined || checks.length==0){
		alert("至少选择一条数据");
		return;
	}
	$(checks).each(function(){
		nstc.sf.delCurrRow(this)
	});
}
//合同金额删除按钮
function doDelAmount(obj){
	var list=$('div[id$="_amount"]');
	var checks=list.find('input[id$="_check"]:checked');
	if(checks==undefined || checks.length==0){
		alert("至少选择一条数据");
		return;
	}
	$(checks).each(function(){
		nstc.sf.delCurrRow(this)
	});
}
//录入 票据信息删除按钮
function doDelBill(obj){
	var list=$('div[id$="_bill"]');
	var checks=list.find('input[id$="_check"]:checked');
	if(checks==undefined || checks.length==0){
		alert("至少选择一条数据");
		return;
	}
	$(checks).each(function(){
		nstc.sf.delCurrRow(this)
	});
}
// 提交/保存  之前先进行校验
function saveCheck(){
	var otherTaxRateIsChecked = true;
	$("[id$='.taxRate']").each(function(){
		if(!checkRate($(this)[0])){
			otherTaxRateIsChecked = false;
		}
	});
	if(!otherTaxRateIsChecked){
		return false;
	}
	var bussVariety = $("[id$='_form.bussVariety']").val();
	var pageCode = $("input[id='pageCode']").val();
	var bussVariety = document.getElementById(pageCode + '_info.bussVariety').value;
	if(!doCheckBankIsNull(bussVariety)){
		alert("合作金融网点不存在！");
		return false;
	}
	var startDate = $('input[id$=.startDate]').val();
	var endDate = $('input[id$=.endDate]').val();
	//校验日期
	if(!compareDate(startDate, endDate, '开始日不能晚于到期日')){
		return false;
	}
	
	//校验合同金额是否存在
	//校验合同金额数据是否存在
	var amount = $("input[id$='_amount.amount']");
	if(amount != undefined && amount != null){
		if(amount.length == 1){
			alert("请录入合同金额信息!")
			return false
		}
	}	
	
	//校验基准类率，利率浮动值，利率
	if(!checkBaseRateAndRate()){
		return false;
	}
	//信用证买方押汇验证票据
	if(bussVariety=="CLMS17"){
		//金额必须大于0
		var amount = $("input[id$='_info.amount']");
		if(!checkAmountIsGreaterThan0(amount)){
			return false;
		}
	var bill = $("table[id^=gdt][id$=_bill]").find("tbody tr:visible");
	if(bill.length == 0){
		alert("请选择押汇单据信息!");
		return false;
	}}
	if(bussVariety == 'CLMS28'){
		var bsn=$("[id$='gdt_product.bondShortName']");
		if(bsn.length == 1){
			alert("请录入产品信息!")
			return false
		}
	}
	
	
/*	var rate=$('input[id$=_info.rate]');
    if(rate && rate.val() !=''){
        if(100.0-parseFloat(rate.val().excludeNotNumericDot())<0){
            alert("利率值不能超过100");
            rate.val('');
            return false;
        }
    }
	
    //信用证打包贷款校验
    var bussVariety = $('[id$=_info.bussVariety]').val();
	if( bussVariety == "CLMS22"){
		if(!checkBillCurrencyNo()){
			alert("信用证币种应与合同币种一致!");
			return false;  
		}
		var amount = $('[id$=_info.amount]').val();
		if(amount == ''){
			alert('合同金额不能为空');
		}
	    if(!checkBillAndAmountToLCG()){
	    	alert("合同金额不能大于信用证开证金额!");
	    	return false;   
	    }
	}*/
    
	//校验融资合同 与 担保合同 大行是否相同
	//TA0640取消校验 by 20180719
//	if(!doCheckBank()){
//		alert("融资合同所属大行与授信合同所属大行不一致");
//		return false;
//	}
	
	var files = $('input[id$=applyFiles_filetext]');
	if(!validateFileForamtBatch(files)){
		alert("系统不允许上传可执行格式的文件");
		return false;
	}
	//授信字段选择了“是”，必须选择授信合同
	if(!checkIsTakeCredit()){
		return false;
	}
	//担保字段选择了“是”，必须选择担保合同
	if(!checkIsTakeGuarantee()){
		return false;
	}
	//校验担保责任比例
	if(!checkeGuaranteeProportion()){
		return false;
	}
	//证券的发行金额总和与专项计划发行规模相等(资产证券化)
	if(!runAdd()){
		return false;
	}
	return true;
}
//校验担保责任比例
/*function checkeGuaranteeProportion(){
	var proportions = $("input[id='gdt_guarantee.proportion']:visible");
	if(proportions != null && proportions.length>0){
		for(var i=0;i<proportions.length;i++){
			var pVal = proportions[i].value.excludeNotNumericDot();
			if(pVal == null || pVal == ''){
				alert("担保责任比例不能为空！");
				return false;
			}
			if(parseFloat(pVal) > 100 || parseFloat(pVal) <= 0){
				alert("担保责任比例只能为0-100之间的数字！");
				return false;
			}
		}
	}
	return true;
}*/
//校验授信
/*function checkIsTakeCredit(){
	var flag = true;
	var isTakeCredit = $("input[id='gdt_credit.isTakeCredit_tmp']:checked").val();
	var count = $("span:visible>input[name='gdt_credit.creditNo']").length;
	if(isTakeCredit == 1 && count == 0){
		alert("授信信息不可为空");
		flag = false;
	}
	return flag;
}*/

//校验担保
/**
 * isAdd 1 :新增 0 选择
 */
/*function checkIsTakeGuarantee(){
	var flag = true;
	var isTakeGuarantee = $("input[id='gdt_guarantee.isTakeGuarantee_tmp']:checked").val();
	var count = $("span:visible>input[name='gdt_guarantee.guaranteeType']").length;
	if(isTakeGuarantee == 1 && count == 0){
		alert("担保信息不可为空");
		flag = false;
	}
	return flag;
}*/

//证券的发行金额总和与专项计划发行规模相等(资产证券化)
/*function runAdd(){
	var pageCode = $("input[id='pageCode']").val();
	if(pageCode == 'gdt_finAppEntry_assetSecu'){
		var amount = $("input[id$='gdt_product.amount']");
		var sum = 0;
		if (amount != "") {
			for (var i = 0; i < amount.length; i++) {
				if (amount[i].value != '') {
					//sum += (isNaN(parseFloat(amount[i].value)) ? 0 : parseFloat(amount[i].value));
					sum = accadd(amount[i].value.excludeNotNumericDot(), sum);
				}
				
			}
			var amount = $("input[id$='gdt_finAppEntry_assetSecu_info.amount']").val().excludeNotNumericDot();
			if(amount != sum){
				alert("证券的发行金额总和与专项计划发行规模必须相等");
				return false ;
			}
		}
	}
	return true;
}*/

//校验票据币种
function checkBillCurrencyNo(){
	var contractCur = $("select[id$='_info.currencyNo']").val();
	var billCur = $("input[id$='_bill.currencyNo']").val();
	if(billCur==''){
		billCur = $("input[id$='_bill.currencyNo']")[1].value;
	}
	var flag = true;
	if(contractCur != undefined && contractCur != null && contractCur != ''
		&& billCur != undefined && billCur != null && billCur != ''){
		if(contractCur != billCur){
			flag = false;
		}
	}
	return flag;
}

function checkBillAndAmountToLCG(){
	
	var billAmount = $("input[id$='_bill.billAmount']").val();
	if(billAmount==''){
		billAmount = $("input[id$='_bill.billAmount']")[1].value;
	}
	var amount = $("input[id$='_info.amount']").val();
	
	var matching = new RegExp("," , "g") ;
    var billAmount= parseFloat(billAmount.toString().replace(matching , ''));
    var amount= parseFloat(amount.replace(matching , ''));
    if(billAmount >= amount){
    	return true;   
    }
    return false;
}

function checkBaseRateAndRate(){
	var flag = true;
	/*$("table[id='gdt_financeApplyEntry_amount']").find("tbody tr:visible").each(function (){
		var baseRate = $(this).find('input[id$=_amount.baseRate]').val();
		var floatType = $(this).find('select[id$=_amount.floatType]').val();
		var floatValue = $(this).find('input[id$=_amount.floatValue]').val();
		if(baseRate=="" && floatType!=2 && floatValue==''){
			alert("没有录入基准利率，不允许选择其他利率变更方式，只允许选择不变。");
			flag = false;
		}
		if(baseRate!="" && floatType!=2 && floatValue==''){
			alert("请录入利率浮动值。");
			flag = false;
		}
	});*/
	return flag;
}

//校验利率
function checkRate(obj){
	var rate = $(obj);
	if(rate.val() != ''){
		if(100.0 - parseFloat(rate.val().excludeNotNumericDot()) < 0){
			var alt = obj.alt;
			alert(alt + "不能超过100");
			rate.val('');
			return;
		}	
		if(rate.val() <0){
			var alt = obj.alt;
			alert(alt + "不能为负数");
			rate.val('');	
		}
//		var amount = $("[id='gdt_amount.amount']").val();
//		$('input[id$=_fees.feesAmount]').val("12312");
//		$('input[id$=_fees.feesAmount]').attr("readOnly",true);
	}
	
}

function doCheckBank(){
	var flag = true;
	//         gdt_financeApplyEntry_credit.assBankId
	var creditBankId = $('input[id$=_credit.assBankId]').val();
	if(creditBankId == ''){
		try {
			creditBankId = $('input[id$=_credit.assBankId]')[1].value; 
		} catch (e) {}
	}
	var assBankId = $('input[id$=_info.assBankId]').val();
	if(assBankId!= undefined && assBankId != '' && assBankId != null
			&& creditBankId!= undefined && creditBankId != '' && creditBankId != null){
		var state = checkConAndCreditBank(assBankId,creditBankId);
		if(state == "false"){
			flag = false;
		}
	}
	return flag;
}

//清空数据
function emptyData(){
	//清空授信数据
	$("table[id=gdt_financeApplyEntry_credit]").find("tbody tr:visible").remove();
	//显示授信div
	$("div[id='div.gdt_financeApplyEntry_credit']").show();
	//清空担保数据
	emptyGuarantee();
	//显示担保方式
	$("div[id='div.gdt_financeApplyEntry_way']").show();
}

//异步加载业务品种
function queryBussVariety(obj,obj2){
	var bussClass = obj.value;
	var bussVariety = obj2.value;
	
	//删除数据
	//emptyData();
	
	//如果业务分类为空,控制业务品种为空.
	if(bussClass == ''){
		var bussVar = $("[id$=bussVariety]")[0];
		bussVar.innerHTML = "";
		bussVar[0] = new Option("", "");
		return;
	}
	doChange(obj,obj2);
}
function doChange(obj,obj2){
	var bussClass = obj.value;
	var bussVariety = "";
	if(obj2 != undefined && obj2 !=null){
		bussVariety = obj2.value;
	}
	$.ajax({
		  type: 'POST',
		  url: "GDEBIT@QueryBussVaresBusiness.sf",
		  async : false,
		  data: {'bussClass':bussClass,'model':'add'},
		  dataType:'json',
		  success: function(data) {
			  var bussVar = $("[id$=bussVariety]")[0];
			  bussVar.innerHTML = "";
			  bussVar[0] = new Option("", "");
			  if (data.length > 0) {
				  for ( var i = 0; i < data.length; i++) {
					  var name = data[i].name;
					  var value = data[i].value;
					  bussVar[i+1] = new Option(name, value);
					  if(data[i].value == bussVariety && data[i].value !="" ){
						 bussVar.value =  bussVariety;
					  }
				  }
			  } else {
				  bussVar = new Option("", "");
			  }
		  },
		  error:function(){
			  alert("业务繁忙!");
		  }
	})
}
//获取融资业务分类
function getBussClass(){
	$.ajax({
		  type: 'POST',
		  url: "GDEBIT@QueryBussClassBusiness.sf",
		  async : false,
		  dataType:'json',
		  success: function(data) {
			  var bussClass = $("select[id$=.bussClass]")[0];
			  bussClass[0] = new Option("","");
			  if (data.length > 0) {
				  for ( var i = 1; i < data.length+1; i++) {
					  var name = data[i-1].name;
					  var value = data[i-1].value;
					  bussClass[i] = new Option(name, value);
				  }
			  } 
		  }
	})
}

function smartForm_confirm(msg){
	var isApprove = $("[id$=.isApprove]").val();
	if(isApprove==1){
		alert(msg);	
		var objbut = top.Layer.getWin().document.getElementById("gdt_financeApply_qry.refresh");
		if(objbut){
			objbut.click();
		}
		 windowClose();
	}else{
		var m = document.getElementById('m').value;
		/*var objbut = top.Layer.getWin().document.getElementById("gdt_financeApply_qry.refresh");
		if(objbut){
			objbut.click();
		}*/
		if(m=='e'){
			//alert(msg);
			if(confirm(msg)){
				//var tr = nstc.sf.findParent(obj, 'tr');
				var objbut = top.Layer.getWin().document.getElementById("gdt_financeApply_qry.refresh");
				if(objbut){
					objbut.click();
				}
				windowClose();
			}else{
//				var applyId = $('input[id$="_info.applyId"]').val();
//				var bussVariety = $('input[id$="_info.bussVariety"]').val();
//				var url = getApplyUrl(bussVariety) + '?m=e&applyId=' + applyId;
//				location.href = url;
			}
		}else if (confirm(msg)){
			var objbut = top.Layer.getWin().document.getElementById("gdt_financeApply_qry.refresh");
			if(objbut){
				objbut.click();
			}
			windowClose();
		}else{
//			var applyId = $('input[id$="_info.applyId"]').val();
//			var bussVariety = $('select[id$="_info.bussVariety"]').val();
//			var url = getApplyUrl(bussVariety) + '?m=e&applyId=' + applyId;
//			location.href = url;
		}
	}
	
}
function smartForm_confirm_false(){
	var nstc_id= top.Layer.getWin().NSTC_LAYER_ID;
	window.NSTC_LAYER_ID = nstc_id;
	var pageCode = $("input[id$='pageCode']").val();
	window.location.reload("GDEBIT@"+pageCode+".sf?m=a");
	var docu = top.Layer.getWin().document;
	$(docu).find("input[id$='refresh']").click();
	setTimeout(function(){
		top.Layer.getWin().NSTC_LAYER_ID = nstc_id;
	},2000);
}


//改变业务品种
function changeForDelUtil(obj){
	emptyGuarantee();
	var variety = obj.value;
	var bussClass = $("select[id$='_info.bussClass']").val();
	var cltNo = $("input[id$='_info.cltNo']").val();
	var cltName = $("input[id$='_info.cltName']").val();
	var cltInfo = "";
	$("table[id=gdt_financeApplyEntry_credit]").find("tbody tr:visible").remove();
	var url = "";
	if(cltNo != null && cltNo != ''){
		cltInfo = cltInfo + "&cltNo="+cltNo;
	}
	if(cltName != null && cltName != ''){
		cltInfo = cltInfo + "&cltName="+cltName;
	}
	url = getApplyUrl(variety)+'?m=a&isApprove=0&bussVariety=' + variety + "&bussClass=" + bussClass + cltInfo;
    //url = 'GDEBIT@gdt_financeApplyEntry.sf?m=a&isApprove=0&bussVariety=' + variety + "&bussClass=" + bussClass + cltInfo;
	location.href = url;
}
//计算利率   
function doCount(obj){
	var tr = nstc.sf.findParent(obj, "TR");
	//基准利率
	var baseRate = $(tr).find("input[id$='.baseRate']").val();
	//浮动方式
	var floatType = $(tr).find("select[id$='.floatType']").val();
	//浮动值
	var floatValue = $(tr).find("input[id$='.floatValue']").val();
	//最终利率
	var rate = $(tr).find("input[id$='.rate']").val();
    //上浮
    if(floatType==0){
    	rate = FormatNumber(baseRate*(1+floatValue*1/100), 6);
    //下浮
    }else if(floatType==1) {
    	rate = FormatNumber(baseRate*(1-floatValue*1/100), 6);
    //不变
    }else if(floatType==2) {
    	rate = baseRate;
    //加点
    }else if(floatType==3) {
    	rate = FormatNumber(baseRate+(floatValue*0.01), 6);
    //减点
    }else if(floatType==4){
    	rate = FormatNumber(baseRate-(floatValue*0.01), 6);
    }
    $(tr).find("input[id$='.rate']").val(rate);
}

//选择金融合作网点
function selectAssBank(obj){
	var tr = nstc.sf.findParent(obj, 'tr');
	var rowIndex = tr.rowIndex - 1;
	var url = "GDEBIT@gdt_associateBankSlt.sf?rowIndex="+rowIndex;
	openwin(url, '金融合作网点列表', 900, 600);
}

//选择 -- 金融合作网点
var lastBankNo = "";
function setAssBank(obj){
	var rowIndex = obj.rowIndex;
	var assBankId= obj.assBankId;
	var assBankName= obj.assBankName;
	var bankNo = obj.bankNo;
	var bankName = obj.bankName;
	
	if (obj.flag == '1') {
		//交易项[承销机构]获取合作金融网点
		$("input[id='gdt_underwrite.bankname']")[rowIndex].value = assBankName;
		$("input[id='gdt_underwrite.bankno']")[rowIndex].value = bankNo;
		$("input[id='gdt_underwrite.assBankId']")[rowIndex].value = assBankId;
	} else if (obj.flag == '2') {
		//交易项[中介机构]获取合作金融网点
		$("input[id='gdt_agency.bankname']")[rowIndex].value = assBankName;
		$("input[id='gdt_agency.bankno']")[rowIndex].value = bankNo;
	} else if (obj.flag == '3') {
		//交易项[出资方]获取合作金融网点
		$("input[id='gdt_investor.investorName']")[rowIndex].value = assBankName;
		$("input[id='gdt_investor.assBankId']")[rowIndex].value = assBankId;
	} else {
		//融资申请获取合作金融网点
		if(lastBankNo == "")lastBankNo = $("input[id$='_info.bankNo']").val();
		if(lastBankNo == "")lastBankNo = bankNo;
		//校验 银行 和 币种 
		var flag = checkBankAndCur(obj);
		var rowIndex = obj.rowIndex;
		var assBankId= obj.assBankId;
		var assBankName= obj.assBankName;
		var bankNo = obj.bankNo;
		var bankName = obj.bankName;
		$("input[id$='_info.bankName']").val(bankName);
		if(flag){
			$("input[id$='_info.assBankId']").val(assBankId);
			$("input[id$='_info.assBankName']").val(assBankName);
			$("input[id$='_info.bankNo']").val(bankNo);
			//回显后计算利率
			setLoanRateAllForApply();
		}
		//切换合作金融网点大行，清空授信担保信息，查询利率
		if(lastBankNo != bankNo){
			try {
				emptyGuarantee();
			} catch (e) {}
			
			try {
				emptyCredit();
			} catch (e) {}
			lastBankNo = bankNo;
			
			//查询利率
			setLoanRateAllForApply();
		}
	}
}

//校验同一家银行币种是否重复
function checkBankAndCur(obj){
	var curList=$("select[id$='_amount.currencyNo']");
	//0是空,从1开始
	var curStr = '';
	for(var i = 1; i < curList.length; i++) {
		var curVal = curList[i].value;
		if(curVal != "" && curVal != undefined){
			var num = curStr.indexOf(curVal+',');
			if(num == -1){
				curStr = curStr.concat(curVal,',');
			}else{
				alert('同一家银行不能出现重复币种!');
				curList[i].value = '';
				return;
			}
		}
	}
	return true;
}




//校验合同能否多添加金额合同
function doCheck(obj){
	var varList = "CLMS08,CLMS09,CLMS10,CLMS11,CLMS12,CLMS13,CLMS14,CLMS15," +
	"CLMS17,CLMS19,CLMS21,CLMS22,CLMS20,CLMS16,CLMS18,CLMS23,CLMS24,CLMS25," +
	"CLMS01,CLMS02,CLMS03,CLMS04,CLMS26";
	
	var m = document.getElementById('m').value;
	var amount = $("input[id$='amount.amount']");
	var temp = amount.length;
	var bussVariety;
	
	//新增模式下校验
	if(m !=null && m!='v' && m!='e'){
		bussVariety = $("select[id$='info.bussVariety']").val();
	}else{
		bussVariety = $("input[id$='info.bussVariety']").val();
	}
	
	if(bussVariety == undefined || bussVariety == null || bussVariety == ""){
		alert("请先选择业务分类和品种!");
		return ;
	}
	
	if(temp*1 > 1){
		var index = varList.indexOf(bussVariety);
		if(index*1 != -1){
			alert("该业务品种只允许选择一条合同金额!");
			return ;
		}
	}
	
	var tr = $(smartForm_add(obj));
	
	//承兑汇票,票据贴现,定死币种
	if(bussVariety == 'CLMS10' || bussVariety == 'CLMS11'){
		var pageCode = $("input[id=pageCode]").val();
		$("select[id=gdt_financeApplyEntry_amount.currencyNo]:visible").parent().html("人民币"
				+"<input id='gdt_financeApplyEntry_amount.currencyNo' " +
						"name='gdt_financeApplyEntry_amount.currencyNo' " +
						"type='hidden' value='CNY'/>");
	}
	
	//查询利率
	var amountObj = tr.find("input[id$='_amount.amount']");
	queryLoanRateForApply(amountObj);
}

//删除合同金额中多余的数据
function deleteMoreTr(obj){
	var temp = $("tr[id$='tableCopy_gdt_financeApplyEntry_amount']");
	if(temp.length > 1){
		for ( var int = 1; int < temp.length; int++) {
			$(temp[int]).remove();
		}
	}
	changeForDelUtil(obj);
}

//录入 费用信息删除按钮
function doDelFees(obj){
	var list=$('div[id$="_fees"]');
	var checks=list.find('input[id$="_check"]:checked');
	if(checks==undefined || checks.length==0){
		alert("至少选择一条数据");
		return;
	}
	$(checks).each(function(){
		nstc.sf.delCurrRow(this)
	});
}
//by zyx start
//录入出资方信息删除按钮
function doDelInvestor(obj){
	var list=$('div[id$="_investor"]');
	var checks=list.find('input[id$="_check"]:checked');
	if(checks==undefined || checks.length==0){
		alert("至少选择一条数据");
		return;
	}
	$(checks).each(function(){
		nstc.sf.delCurrRow(this)
	});
}

//录入标的物信息删除按钮
function doDelProject(obj){
	var list=$('div[id$="_project"]');
	var checks=list.find('input[id$="_check"]:checked');
	if(checks==undefined || checks.length==0){
		alert("至少选择一条数据");
		return;
	}
	$(checks).each(function(){
		nstc.sf.delCurrRow(this)
	});
}
//end
//重置
function doReSet(obj){
	var pageCode = $("input[id$=pageCode]").val();
	var applyId = $("input[id$=_info.applyId]").val(); 
	var bussVariety = $("input[id$=_info.bussVariety]").val();
	var m = document.getElementById('m').value;
	var url = "GDEBIT@"+pageCode+".sf?m="+m+"&applyId="+applyId+"&bussVariety="+bussVariety;
	location.href = url;
} 

//选择信用证
function doSelCreditBill(){
	var applyNo = $("input[id$=_info.cltNo]").val();
	if(applyNo == undefined || applyNo == null || applyNo == ''){
		alert("请先选择单位")
		return ;
	}
	//币种
    var currencyNo = $("select[id$='_info.currencyNo']").val();
    //申请日
    var applyDate = $("input[id$=_info.applyDate]").val();
    //到期日
    var endDate = $("input[id$=_info.endDate]").val();
	var bussVariety = $("select[id$=_info.bussVariety]").val();
	if(bussVariety == undefined)bussVariety = $("input[id$=_info.bussVariety]").val();
	var url="GDEBIT@gdt_select_LC.sf?m=v&applyNo="+applyNo+"&bussVariety="+bussVariety+"&currencyNo="+currencyNo+"&applyDate="+applyDate+"&endDate="+endDate;
	openwin(url, '选择国际信用证', 800,600);
}
//录入 票据信息删除按钮
function doDelBill(obj){
	var list=$('div[id$="_bill"]');
	var checks=list.find('input[id$="_check"]:checked');
	if(checks==undefined || checks.length==0){
		alert("至少选择一条数据");
		return;
	}
	$(checks).each(function(){
		nstc.sf.delCurrRow(this)
	});
}

//校验是否为负数
function checkNegative(obj){
	var num1 = $(obj);
	if(num1.val() <0){
		var alt = obj.alt;
		alert(alt + "不能为负数");
		num1.val('');
		return;
	}
}

//选择 -- 境外金融合作网点
function setAssOutBank(obj){
	var assBankId= obj.assBankId;
	var assBankName= obj.assBankName;
	
	$("input[id$='_info.overseasBank']").val(assBankId);
	$("input[id$='_info.overseasBankName']").val(assBankName);
}
