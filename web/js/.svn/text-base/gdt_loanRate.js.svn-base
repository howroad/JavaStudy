$(function(){
	var obj = $("select[id$='.currencyNo']").get(0);
	
	var curNo = $("select[id$='.currencyNo']").val();
	if(curNo == "CNY" || curNo == '')
		$("select[id$='.bankNo']").val('').attr('disabled',true);
	else
		$("select[id$='.bankNo']").attr('disabled',false);
});

// 添加按钮,弹出添加窗口
function doAdd(){
	var url = 'GDEBIT@gdt_loanRateAdd.sf?m=a';
	openwin(url, '贷款利率设置', 800, 400);
}

// CNY则不显示金融机构
function checkBankAndCur(obj){
	var curNo = obj.value;
	if(curNo == "CNY" || curNo == '')
		$("select[id$='.bankNo']").val('').attr('disabled',true);
	else
		$("select[id$='.bankNo']").attr('disabled',false);
}
// 增加界面CNY则不显示金融机构
function checkBankAndCur2(obj){
	var curNo = obj.value;
	if(curNo == "CNY")
		$("select[id$='.bankNo2']").val('').attr('disabled',true);
	else
		$("select[id$='.bankNo2']").attr('disabled',false);
}
//保存按钮
function doSubmit(obj){
	var checkNum=getCheckNum();
	if (checkNum == 0) {
		alert("至少选择一条记录！");
		return;
	}
	var bankNo = $("select[id$='.bankNo2']").val();
	var currencyNo = $("select[id$='.currencyNo2']").val()
	if (currencyNo == 'CNY') {
		bankNo = '';
	} else if(bankNo == ''){
		alert("金融机构不能为空");
		return;
	}
	
	var checkObj = $("[id$=._check]:visible");
	for ( var i = 0; i < checkObj.length; i++) {
		if (checkObj[i].checked) {
			var tr = $(checkObj[i]).parents("tr").first();			
			tr.find("input[id$='.currencyNo']").val(currencyNo);
			tr.find("input[id$='.bankNo']").val(bankNo);
			var activeDate = tr.find("input[id$='.activeDate']").val();
			if (activeDate == '') {
				alert("生效日期不能为空");
				return;
			}
			var rateValue = tr.find("input[id$='.rateValue']").val();
			if (rateValue == '') {
				alert("利率值不能为空");
				return;
			}
		}
	}
	smartForm_doSave(obj);
}

//点击确定操作
function smartForm_confirm_true(){
	//$("#父窗口元素ID",window.parent.document);
	var objbut = top.Layer.getWin().document.getElementById("gdt_loanRateSet_list.refresh");
	if(objbut){
		objbut.click();
		windowClose();
	}
}
function smartForm_confirm(msg) {
	alert(msg);
	smartForm_confirm_true();
}

//删除按钮
function doDelete(obj){
	var checkNum=getCheckNum();
	if (checkNum == 0) {
		alert("至少选择一条记录！");
		return;
	}
	if(confirm("确认删除？")){
		smartForm_doSave(obj);
	}
}
//获取选中的行
function getCheckNum(){
	//var checkNum_ = $("input[id$='._check'] checked").length;
	var checkObj = $("[id$=._check]:visible");
	var checkNum = 0;
	for ( var i = 0; i < checkObj.length; i++) {
		if (checkObj[i].checked) {
			checkNum++;
		}
	}
	return checkNum;
}
//校验利率
function checkRate(obj){
	var rate = parseFloat(obj.value.excludeNotNumericDot());
	var alt = obj.alt;
	if(rate){
		if(rate <= 0){
			alert(alt + "利率必须大于0");
			obj.value = "";	
			return;
		}
		if(rate >= 100.0){
			alert(alt + "利率不能超过100");
			obj.value = "";
			return;
		}
	}
}