//查看融资合同
function showContract(obj){
	var tr = nstc.sf.findParent(obj, "TR");
	var bussVariety = $(tr).find("input[id$='.bussVariety']").val();
	var contractId = $(tr).find("input[id$='.contractId']").val();
	//doSelContract(bussVariety,null,null,contractId,"v");
}

//查看授信合同
function showCredit(obj){
	var tr = nstc.sf.findParent(obj, "TR");
	var occupyId = $(tr).find("input[id$='.creditContractId']").val();
	if(occupyId =='')return;
	var url = 'CLMS-Web@clms_creditContractEntry.sf?m=v&contractId=' + occupyId;
	openwin(url, '授信合同详情', 900, 600);
}

function doSubmit(obj){
	// 提交按钮,提交融资申请
	var checkNum=getCheckNum();
	if (checkNum == 0) {
		alert("至少选择一条记录！");
		return;
	}
	smartForm_doSave(obj);
}

//获取选中的行
function getCheckNum(){
	var checkObj = $("[id$=._check]:visible");
	var checkNum = 0;
	for ( var i = 0; i < checkObj.length; i++) {
		if (checkObj[i].checked) {
			checkNum++;
		}
	}
	return checkNum;
}

// 全选
function checkAll(obj){
	smartForm_all_checkbox(obj,'gdt_creditChangeWait_list._check');
	getCheckSize();
}

// 选择某一个
function checkRec(obj){
	nstc.sf.clickCheckbox(obj);
	getCheckSize();
}

function getCheckSize(){
	var selectRecords = $("[id$=selectRecords]").val();
	var checkNum=getCheckNum();
	var selectRecordsHtml  = '<input id="selectRecords" name="selectRecords" type="hidden" value="'+selectRecords+'"/>'
	$("[id$=selectRecords]").parent().html("共计"+selectRecords+"笔，已选"+checkNum+"笔。"+selectRecordsHtml);
}

//查看
function doLookCredit(obj){
	showInput(obj, "v");
}

//修改
function doUpdateCredit(obj){
	showInput(obj, "e");
}

function showInput(obj,m){
	var tr = nstc.sf.findParent(obj, "TR");
	var bussVariety = $(tr).find("input[id$='.bussVariety']").val();
	var fmId = $(tr).find("input[id$='.fmId']").val();
	var contractId = $(tr).find("input[id$='.contractId']").val()
	var url = 'GDEBIT@gdt_creditChangeInput.sf?m=' + m 
		+ '&fmId='+fmId + "&contractId=" + contractId;
	openwin(url, m=='v'?'授信占用变更详情':'授信占用变更录入', 1200, 600);
}



//点击确定操作
function smartForm_confirm_true(){
	//$("#父窗口元素ID",window.parent.document);
	var objbut = top.Layer.getWin().document.getElementById("gdt_creditChangeWait_qry.refresh");
	if(objbut){
		objbut.click();
		windowClose();
	}
}
function smartForm_confirm(msg) {
	alert(msg);
  smartForm_confirm_true();
}

//查询操作
function doQuery(obj){
	var minDate = $('input[id$=.minDate]').val();
	var maxDate = $('input[id$=.maxDate]').val();
	if(!compareDate(minDate, maxDate, '变更日期范围不合理')){
		return;
	}
	smartForm_doRefresh(obj)
}


//删除按钮, 删除融资申请
function doDelete(obj){
	var checkNum = getCheckNum();
	if (checkNum == 0) {
		alert("至少选择一条记录！");
		return;
	}
	if(confirm("确认删除？")){
		smartForm_doSave(obj);
	}
}
