//间接融资-贸易融资》信用证押汇	
$(function(obj){
	var m = document.getElementById('m').value;
	/*var bussClass = $("select[id$=.bussClass]").val('CLMS03');*/
	var bussClass = $("select[id$='.bussClass']").attr('value','CLMS03');
	var bussVariety = $("select[id$='.bussVariety']");
	var bussVarietyVal = bussVariety.val();
	if(m =='a'){
		doChange(bussClass[0]);
		//隐藏业务品种和分类,展示值
		/*$("select[id$=.bussVariety]").val("CLMS17");*/
		$("select[id$='.bussVariety']").attr('value',"CLMS17");
	}
	
	
	var cltName = $("input[id$='.cltName']").val();
	var apply = $("input[id$='_form.applyId']").val();
	if(apply != undefined && apply != null && apply != ''){
		var clt = $("input[id$='_info.cltName']");
		doHiddenApply(clt);
		//doHidden(bussClass,bussVariety);
		//隐藏票据选择
		$('[id$="bill.sel"]').hide();
		$('[id$="bill.del"]').hide();
		var list=$('table[id="'+$('input[id$="pageCode"]').val()+'_bill"]');
		var trs=list.find('tbody tr:visible');
		for(var i=0;i<trs.length;i++){
			$(trs[i]).find('input[id$="_check"]').hide().attr({"disabled":true});
		}
	}else if(apply == undefined){
		/*$("select[id$=.bussVariety]").val(bussVarietyVal);*/
		$("select[id$='.bussVariety']").attr('value',bussVarietyVal);
	}
	//币种是人民币隐藏锁汇
	var currencyNo = $('[id$=.currencyNo]').val();
	if('CNY'==currencyNo){
		//币种是人民币隐藏锁汇
		$("[id$='lockGunCash']").parent().parent().parent().hide();
		$("[id$='lockBank']").parent().parent().parent().hide();
	}else{//外币显示
		$("[id$='lockGunCash']").parent().parent().parent().show();
		$("[id$='lockBank']").parent().parent().parent().show();
	}
	
	
	var channel = $("input[id$='gdt_conImportLCBill_form.channel']").val();
    //当channel字段不为GDEBIT时，将带入的数据置换为不可写
	if(isNotNull(channel) && channel != "GDEBIT"){
		var table = $("#gdt_conImportLCBill_info");
		doReadOnly(table);
	}
});

//add by liyang 20180802 start
//根据币种是否显示锁汇
function isShowLockRate(){
	var currencyNo = $('[id$=.currencyNo]').val();
	if('CNY'==currencyNo){
		//币种是人民币隐藏锁汇
		$("[id$='lockGunCash']").parent().parent().parent().hide();
		$("[id$='lockBank']").parent().parent().parent().hide();
	}else{//外币显示
		$("[id$='lockGunCash']").parent().parent().parent().show();
		$("[id$='lockBank']").parent().parent().parent().show();
	}
}
//根据信用证设置币种
function setCurrencyNo(){
	var credit = $('[id$=.credit]').val();
	if(credit==2){//国内信用证显示人民币
		$('[id$=.currencyNo]').val('CNY');
		$('[id$=.currencyNo]').attr('disabled','true');
	}else{
		$('[id$=.currencyNo]').removeAttr('disabled');
	}
}

//add by liyang 20180802 end

//提交/保存  之前先进行校验
function saveCheck(){
	$("input").removeAttr("disabled");
	var bussVariety = $("select[id$='_form.bussVariety']").val();
	if(bussVariety == undefined) bussVariety = $("input[id$='_form.bussVariety']").val();
	if(!doCheckBankIsNull(bussVariety)){
		alert("合作金融网点不存在！");
		return false;
	}
	
	var bill = $("table[id^=gdt][id$=_bill]").find("tbody tr:visible");
	if(bill.length == 0){
		alert("请选择押汇单据信息!");
		return false;
	}
	
	var tr = $(bill.get(0));
	var applyDate = $("input[id$=_info.applyDate]").val();
	var applyMsg = "申请日期";
	if(applyDate == undefined){
		applyDate = $("input[id$=_info.contractDate]").val();
		applyMsg = "签约日期"
	}
	//到单日期
	var dueDate = tr.find('input[id$=_bill.endDate]').val();
	if(!compareDate(dueDate,applyDate, applyMsg+'不能早于单据的到单日期')){
		return false;
	}
	//开始日
	var startDate = $('input[id$=.startDate]').val();
	if(!compareDate(applyDate,startDate,applyMsg+'不能晚于开始日期')){
		return false;
	}
	//预计付款日
	var payDate = tr.find('input[id$=_bill.payDate]').val();
	if(!compareDate(startDate, payDate, '开始日不能晚于单据预计付款日')){
		return false;
	}
	
	var files = $('input[id$=applyFiles_filetext]');
	if(!validateFileForamtBatch(files)){
		alert("系统不允许上传可执行格式的文件");
		return false;
	}
	return true;
}

////提交前使币种属性可提交
//function doEntrySave(obj){
//	alert(111)
//	$("[id$=.isApprove]").val("0");
//	$('[id$=.currencyNo]').removeAttr('disabled');
//	smartForm_doSave(obj);
//}
////提交前使币种属性可提交
//function doEntrySubmit(obj){
//	$("[id$=.isApprove]").val("1");
//	$('[id$=.currencyNo]').removeAttr('disabled');
//	smartForm_doSubmit(obj);
//}


//选择押汇单据
function doSelectSDBill(){
	var bill = $("table[id^=gdt][id$=_bill]").find("tbody tr:visible");
	/*if(bill.length > 0){
		alert("只能选择一条押汇单据信息!");
		return;
	}*/
	var cltNo = $("input[id$=_info.cltNo]").val();
	if(cltNo == ''){
		alert("请先选择单位")
		return;
	}
	
	//信用证类别
	var credit = $('[id$=.credit]').val();
	//单位名称后加信用证类别
	var cltName = $("input[id$=_info.cltName]").val()+"  信用证 ："+(credit==1?'国际信用证':'国内信用证');
	var url="GDEBIT@gdt_select_SDD.sf?m=v&cltNo="+cltNo+"&cltName="+cltName+"&credit="+credit;
	openwin(url, '选择单据', 1100,600);
	//大行
//	var bankName = $("input[id$=_info.bankName]").val();
	
	//弹出选择押汇单据页面，如果信用证类别为国内信用证，币种默认为人民币
//	var currencyNo = $("select[id$='_info.currencyNo']").val();
	
	//申请日
//	var applyDate = $("input[id$=_info.applyDate]").val();
//	if(applyDate == undefined){
//		applyDate = $("input[id$=_info.contractDate]").val();
//	}
	// 开始日
//	var payDate = $("input[id$=_info.startDate]").val();
//	var url="GDEBIT@gdt_select_SDD.sf?m=v&cltNo="+cltNo+"&cltName="+cltName+"&bankName="+bankName
//	+"&currencyNo="+currencyNo+"&applyDate="+applyDate+"&payDate="+payDate+"&credit="+credit;
//	openwin(url, '选择单据', 1100,600);
}
//回显单据
function setSDBill(data){
	var checks= $('input[id$="_bill.billId"]');
	if(checks != undefined && checks.length != 0){
		$(checks).each(function(){
			if(this.value==undefined || this.value == null || this.value == '')return;
			nstc.sf.delCurrRow(this)
		});
	}
	
	var billNo = data.billNo;
	var billId = data.billId;
	var lcNo = data.lcNo;
	var lcWbId = data.lcWbId;
	var payBankName = data.payBankName;
	var payBankNo = data.payBankNo;
	var endDate = data.endDate;
	var currencyName = data.currencyName;
	var currencyNo = data.currencyNo;
	var billAmount = data.billAmount;
	var payDate = data.payDate;
	var supplierName = data.supplierName;
	var description = data.description;
	
	var forexType = data.forexType;
	var forexTypeName = data.forexTypeName;
	var lcAmount = data.lcAmount;
	var accBankName = data.accBankName;
	var lcDueDate = data.lcDueDate;
	
	var btnAdd = $("input[id$='_bill.add']")[0];
	var tr_row = smartForm_add(btnAdd);
	var tr = $(tr_row);
	
	tr.find("input[id$='.billId']").val(billId);
	tr.find("input[id$='.lcWbId']").val(lcWbId);
	tr.find("input[id$='.billAmount']").val(billAmount);
	tr.find("input[id$='.currencyNo']").val(currencyNo);
	
	var pageCode = $("input[id$='pageCode']").val();
	var billNoHtml  = "<input id='"+pageCode+"_bill.billNo' name='"+
	pageCode+"_bill.billNo' type='hidden' value='"+billNo+"'/>";
	var billidHtml  = "<input id='"+pageCode+"_bill.billId' name='"+
	pageCode+"_bill.billId' type='hidden' value='"+billId+"'/>";
    var billNoLink = "<a href='#' onclick='showSDBillMsg(this)'>" + billNo + "</a>";
	tr.find("input[id$=_bill.billNo]").parent().parent().html(billNoLink +billidHtml+ billNoHtml);
	
	var lcNoHtml  = "<input id='"+pageCode+"_bill.lcNo' name='"+
	pageCode+"_bill.lcNo' type='hidden' value='"+lcNo+"'/>";
	var lcNoLink = "<a href='#' onclick='showLCbill(this)'>" + lcNo + "</a>";
	tr.find("input[id$=_bill.lcNo]").parent().html(lcNoLink + lcNoHtml);
	
	var payBankNoHtml  = "<input id='"+pageCode+"_bill.payBankNo' name='"+
	pageCode+"_bill.payBankNo' type='hidden' value='"+payBankNo+"'/>";
	tr.find("input[id$=_bill.payBankNo]").parent().html(payBankName + payBankNoHtml);
	
	var endDateHtml  = "<input id='"+pageCode+"_bill.endDate' name='"+
	pageCode+"_bill.endDate' type='hidden'  value='"+endDate+"'/>";
	tr.find("input[id$=_bill.endDate]").parent().html(endDate + endDateHtml);
	
	/*var currencyNameHtml  = "<input id='"+pageCode+"_bill.currencyName' name='"+
	pageCode+"_bill.currencyName' type='hidden' value='"+currencyName+"'/>";
	tr.find("input[id$=_bill.currencyName]").parent().html(currencyName + currencyNameHtml);*/
	
	var currencyNoHtml  = "<input id='"+pageCode+"_bill.currencyNo' name='"+
	pageCode+"_bill.currencyNo' type='hidden' value='"+currencyNo+"'/>";
	tr.find("input[id$=_bill.currencyNo]").parent().html(currencyName + currencyNoHtml);
	
	var billAmountHtml  = "<input id='"+pageCode+"_bill.billAmount' name='"+
	pageCode+"_bill.billAmount' type='hidden' value='"+billAmount+"'/>";
	tr.find("input[id$=_bill.billAmount]").parent().html("<span style ='text-align: right; font-weight: bold;'>"+FormatMoney(billAmount,2)+"</span>"
			+billAmountHtml);
	
	var payDateHtml  = "<input id='"+pageCode+"_bill.payDate' name='"+
	pageCode+"_bill.payDate' type='hidden' value='"+payDate+"'/>";
	tr.find("input[id$=_bill.payDate]").parent().html(payDate + payDateHtml);

	var supplierNameHtml  = "<input id='"+pageCode+"_bill.supplierName' name='"+
	pageCode+"_bill.supplierName' type='hidden' value='"+supplierName+"'/>";
	tr.find("input[id$=_bill.supplierName]").parent().html(supplierName + supplierNameHtml);
	
	var descriptionHtml  = "<input id='"+pageCode+"_bill.description' name='"+
	pageCode+"_bill.description' type='hidden' value='"+description+"'/>";
	tr.find("input[id$=_bill.description]").parent().html(description + descriptionHtml);
}

