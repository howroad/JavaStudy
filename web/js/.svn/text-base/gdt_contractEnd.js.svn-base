//   融资申请页面 
$(function (){
	//动态显示授信品种
	var bussClass= $('select[id$=_qry.bussClass]').get(0);
	var bussVariety=$('select[id$=_qry.bussVariety]').get(0);
	queryBussVares(bussClass,bussVariety);
})
/**
 * 
 */
$(function(){
	finishType();
});
// 全选
function checkAll(obj){
	smartForm_all_checkbox(obj,'gdt_contractEnd_list._check');
	getCheckSize();
}

// 选择某一个
function checkRec(obj){
	nstc.sf.clickCheckbox(obj);
	getCheckSize();
}
//获取选中的行
function getCheckNum(){
	var checkObj = $("[id$=._check]:visible");
	var checkNum = 0;
	for ( var i = 0; i < checkObj.length; i++) {
		if (checkObj[i].checked) {
			checkNum++;
		}
	}
	return checkNum;
}
function getCheckSize(){
	var selectRecords = $("[id$=selectRecords]").val();
	var checkNum=getCheckNum();
	var selectRecordsHtml  = '<input id="selectRecords" name="selectRecords" type="hidden" value="'+selectRecords+'"/>'
	$("[id$=selectRecords]").parent().html("共计"+selectRecords+"笔，已选"+checkNum+"笔。"+selectRecordsHtml);
}
//选择单位
function selectNsClient1(){
	var url = "GDEBIT@gdt_nsClientSlt.sf";
	openwin(url, '单位列表', 500, 400);
}
//选择 -- 修改值
function setNsclient(obj){
	$("input[id$=.cltNo]").val(obj.cltNo);
	$("input[id$=.cltName]").val(obj.cltName);
}
function finishType(){
	var finishT = $('select[id$="finishType"]').val();
	if(finishT == "1"){
		$('input[id$=".reason"]').parents('td').first().hide()
		.prev().hide();
	}else{
		$('input[id$=".reason"]').parents('td').first().show()
		.prev().show();
	}
}
function doRefresh(obj){
	var minAmount = $('input[id$=.minAmount]').val();
	var maxAmount = $('input[id$=.maxAmount]').val();
	var minBalance = $('input[id$=.minBalance]').val();
	var maxBalance = $('input[id$=.maxBalance]').val();
	var minEndDate = $('input[id$=.minEndDate]').val();
	var maxEndDate = $('input[id$=.maxEndDate]').val();
	if(!compareAmount(minAmount, maxAmount, '合同金额范围不合理')){
		return;
	} 
	if(!compareAmount(minBalance, maxBalance, '合同余额范围不合理')){
		return;
	} 
	if(!compareDate(minEndDate, maxEndDate, '到期日期范围不合理')){
		return;
	} 
	smartForm_doRefresh(obj)
}
function doSubmit(obj){
	var info=$('div[id$="gdt_contractEnd_info"]');
	/*var finishType=info.find('select[id$="finishType"]').val();
	var finishDate=info.find('input[id$="finishDate"]').val();*/
	var finishType=$('select[id$="_info.finishType"]').val();
	var finishDate=$('input[id$="_info.finishDate"]').val();
	var fd = new Date(finishDate.replace(/-/g, "/"));
	if (new Date() < Date.parse(fd)) {
		alert('结项日期不能大于当前日期');
		return;
	} 
	var list=$('table[id="gdt_contractEnd_list"]');
	var _checks=list.find('tbody tr:visible input[id$="_check"]:checked');
	if(_checks.length<1){
		alert('至少选择一条数据');
		return;
	}
	if(finishType=='1'){
		for(var i=0;i<_checks.length;i++){
			var balance=$(_checks[i]).parents('tr').first()
				.find('input[id$="balance"]').val().excludeNotNumericDot();
			if(0.00!=parseFloat(balance)){
				alert('正常结项时余额需为0.00');
				return;
			}
			
		}
	}
	smartForm_doSubmit(obj)
}