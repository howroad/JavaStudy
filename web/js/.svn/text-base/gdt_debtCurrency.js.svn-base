var swidth = window.screen.width;
var sheight = window.screen.height;
$(function() {
	var date = new Date();// 默认为当天
	var year = date.getFullYear();
	var month = date.getMonth() + 1;
	var day = date.getDate();
	if (month < 10) {
		month = "0" + month;
	}
	if (day < 10) {
		day = "0" + day;
	}
	var searchDate= $("[id$=gdt_debtCurrency_query.searchDate]").val();
	if (isNull(searchDate)) {
		$("[id$=gdt_debtCurrency_query.searchDate]").val(year + "-" + month + "-" + day);
	}
	
	//金额单位
	$("select[id$='moneyUnit']").attr('value',$("input[id$='moneyUnit']").val());
	//画图数据
	var moneyUnit=$("[id$=gdt_debtCurrency_query.moneyUnit]").val();
	searchDate= $("[id$=gdt_debtCurrency_query.searchDate]").val();
	var nameArray=new Array();
	var amtArray=new Array();
	var perArray=new Array();
	var leg=new Array();
	$.ajax({
		type : 'POST',
		url : "GDEBIT@AjaxDebtCurrencyPie.sf",
		async : false,
		data : {
			"searchDate" : searchDate,
			"moneyUnit"  : moneyUnit
		},
		dataType : "json",
		success : function(da) {
			 for(var i=0;i<da.length;i++){
				 amtArray[i]=da[i].amount;
				 nameArray[i]=da[i].title;
				 perArray[i]=da[i].percent;
					leg[i] = {
							value : da[i].percent,
							name : da[i].title
						};
			 }
		}
	});
	// add一个图形的div
	var div = document.getElementById('gdt_debtCurrency_pie.content');
	div.innerHTML = '<div style="border-width:1px 1px 0 1px;border-color:#C8C8C8;border-style:solid;height:400px;">'

	+'<div style="border-width:0 1px 1px 1px;border-color:#C8C8C8;border-style:solid;height:400px">'
	+'<div id="mainPie" style="width:'+swidth*0.42+'px;height:400px;">'
	+'</div>'
	+'</div>';

	var option = {
		    title : {
		        text: '债务币种结构',
		        x:'center'
		    },
		    tooltip : {
		        trigger: 'item',
		        formatter: function(params) {
		        	var res = params.seriesName+'<br/>';
		        	res+=params.name+':';//+params.value+'('+params.percent.toFixed(2)+'%)';
		        	for(var i=0;i<perArray.length;i++){
		        		if(params.value==perArray[i])
		        			res+=amtArray[i];
		        	}
		        	res+='('+params.percent.toFixed(2)+'%)';
		        	return res;
		        }
		    },
		    legend: {
		        orient: 'vertical',
		        left: 'left',
		        data: leg
		    },
		    series : [
		        {
		            name: '金额单位：'+getUnit(moneyUnit),
		            type: 'pie',
		            radius : '55%',
		            center: ['50%', '60%'],
		            data:leg,
		            itemStyle: {
		                emphasis: {
		                    shadowBlur: 10,
		                    shadowOffsetX: 0,
		                    shadowColor: 'rgba(0, 0, 0, 0.5)'
		                }
		            }
		        }
		    ]
		};
	var myPieChart = echarts.init(document.getElementById('mainPie'));
	myPieChart.setOption(option);
});


function doRefresh(obj){
	var searchDate= $("[id$=gdt_debtCurrency_query.searchDate]").val();
	if(isNull(searchDate)){
		alert("日期不能为空");
	}else{
		smartForm_doRefresh(obj);
	}
}
//

//修改金额单位 刷新页面 改变金额值
function setAmountByUnit(obj) {
	var unit = obj.value;
	$("input[id='gdt_debtCurrency_query.moneyUnit']").val(unit);
	var refreshObj = $("input[id='gdt_debtCurrency_query.refresh']")[0];
	smartForm_doRefresh(refreshObj);
	$("select[id$='moneyUnit']").attr('value',$("select[id$='moneyUnit']").val());
}

//判断是否为空
function isNull(a){
	  if(a == "" || a == null || a == undefined){ // "",null,undefined
	       return true;
	    }
	  return false;
}
//金额单位显示
function getUnit(moneyUnit){
	if(moneyUnit==1)
		return "元";
	if(moneyUnit==1000)
		return "千元";
	if(moneyUnit==10000)
		return "万元";
	if(moneyUnit==1000000)
		return "百万元";
	if(moneyUnit==100000000)
		return "亿元";
}