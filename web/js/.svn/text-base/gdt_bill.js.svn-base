//保函证回调函数
function callBackLG(obj){
	var tr = $(nstc.sf.findParent(obj,"TR"));
	var billNo = tr.find("a[id$=.billNo]").text();  //票据编号
	var billId = tr.find("input[id$=.billId]").val();  //票据编号
	var billType = tr.find("input[id$=.billType]").val();  //保函类型
	var currencyName = tr.find("input[id$=.currencyName]").val();  //币种
	var currencyNo = tr.find("input[id$=.currencyNo]").val();  //币种
	var startDate = tr.find("input[id$=.startDate]").val();  //出票日期
	var endDate = tr.find("input[id$=.endDate]").val();  //出票日期
	var billAmount = tr.find("input[id$=.billAmount]").val().excludeNotNumericDot(); //票面金额
	var accBankName = tr.find("input[id$=.accBankName]").val();  //开立行
	var payee = tr.find("input[id$=.payee]").val();  //受益人
	
	result.currencyNo = currencyNo;
	result.billId = billId;
	result.billType = billType;
	result.payee = payee;
	result.currencyName = currencyName;
	result.endDate = endDate;
	result.startDate = startDate;
	result.billAmount = billAmount;
	result.accBankName = accBankName;
	
	top.Layer.getWin().setLGBill(result);
	windowClose();
}

function callBackLC(checkObj){
	var tr = $(nstc.sf.findParent(checkObj,"TR"));
	
	var billNo = tr.find("input[id$=.billNo]").val();  //票据编号
	var billId = tr.find("input[id$=.billId]").val();  //票据编号
	var billType = tr.find("input[id$=.billType]").val();  //票据类型
	var nature = tr.find("input[id$=.nature]").val();  //性质
	var currencyName = tr.find("input[id$=.currencyName]").val();  //币种
	var currencyNo = tr.find("input[id$=.currencyNo]").val();  //币种
	var endDate = tr.find("input[id$=.endDate]").val();  //有效期
	var startDate = tr.find("input[id$=.startDate]").val();  //出票日期
	var billAmount = tr.find("input[id$=.billAmount]").val().excludeNotNumericDot(); //票面金额
	var accBankName = tr.find("input[id$=.accBankName]").val();  //承兑行
	var supplierName = tr.find("input[id$=.supplierName]").val();  //客户
	
	var result = {};
	result.billNo = billNo;
	result.billId = billId;
	result.billType = billType;
	result.nature = nature;
	result.currencyName = currencyName;
	result.endDate = endDate;
	result.startDate = startDate;
	result.billAmount = billAmount;
	result.accBankName = accBankName;
	result.currencyNo = currencyNo;
	result.supplierName = supplierName;
	if(tr.find("input[id$=.forexType]")){
        result.forexType = tr.find("input[id$=.forexType]").val();
    }
    if(tr.find("input[id$=.backToBack]")){
        result.backToBack = tr.find("input[id$=.backToBack]").val();
    }
	top.Layer.getWin().setLCBill(result);
	windowClose();
}


function callBackBillDisc(){
	var checkObj = $("[id$=._check]:checked");
	if(checkObj.length<1){
		alert("请至少选择一条数据");
		return ;
	}
	
	var arr = [];
	for(var i=0;i<checkObj.length;i++){
		var tr = $(nstc.sf.findParent(checkObj[i],"TR"));
		var billNo = tr.find("a[id$=.billNo]").text();  //票据编号
		var billId = tr.find("input[id$=.billId]").val();  //票据编号
//		var discountAmount = tr.find("input[id$=.discountAmount]").val().excludeNotNumericDot(); //贴现金额
		var billAmount = tr.find("input[id$=.billAmount]").val().excludeNotNumericDot(); //票面金额
		var payee = tr.find("input[id$=.payee]").val();  //收款人
        var recAccount = tr.find("input[id$=.recAccount]").val();  //收款人账户
		//var billType = tr.find("input[id$=.billType]").val();  //票据类型
		var startDate = tr.find("input[id$=.startDate]").val();  //出票日期
		var endDate = tr.find("input[id$=.endDate]").val();  //到期日期
		
		//var accBankName = tr.find("input[id$=.accBankName]").val();  //承兑行
		
		
		//var discountDate = tr.find("input[id$=.discountDate]").val();  //贴现日期
		//var discountRate = tr.find("input[id$=.discountRate]").val();  //贴现利率
//		var dayNum = tr.find("input[id$=.dayNum]").val();  //计息天数
		
		
		var result = {};
		result.billNo = billNo;
		result.billId = billId;
		//result.billType = billType;
		result.startDate = startDate;
		result.endDate = endDate;
		result.billAmount = billAmount;
		//result.accBankName = accBankName;
		result.payee = payee;
		result.recAccount = recAccount;
		//result.discountDate = discountDate;
		//result.discountRate = discountRate;
//		result.dayNum = dayNum;
//		result.discountAmount = discountAmount;
		arr.push(result);
	}
	top.Layer.getWin().setBillDisc(arr);
	windowClose();
}

function callBackAccBill(obj){
	var checkObj = $("[id$=._check]:checked");
	if(checkObj.length<1){
		alert("请至少选择一条数据");
		return ;
	}
	
	var arr = [];
	for(var i=0;i<checkObj.length;i++){
		var tr = $(nstc.sf.findParent(checkObj[i],"TR"));
		var billNo = tr.find("a[id$=.billNo]").text();  //票据编号
		var billId = tr.find("input[id$=.billId]").val();  //票据编号
		var billType = tr.find("input[id$=.billType]").val();  //票据类型
		var startDate = tr.find("input[id$=.startDate]").val();  //出票日期
		var endDate = tr.find("input[id$=.endDate]").val();  //到期日期
		var billAmount = tr.find("input[id$=.billAmount]").val().excludeNotNumericDot(); //票面金额
		var accBankName = tr.find("input[id$=.accBankName]").val();  //承兑行
		var payee = tr.find("input[id$=.payee]").val();  //收款人
		var recAccount = tr.find("input[id$=.recAccount]").val();  //收款人账户
		
		var result = {};
		result.billNo = billNo;
		result.billId = billId;
		result.billType = billType;
		result.startDate = startDate;
		result.endDate = endDate;
		result.billAmount = billAmount;
		result.accBankName = accBankName;
		result.payee = payee;
		result.recAccount = recAccount;
		arr.push(result);
	}
	top.Layer.getWin().setAccBill(arr);
	windowClose();
}

function callBackSD(obj){
	var tr = $(nstc.sf.findParent(obj,"TR"));
	var billNo = tr.find("input[id$=.billNo]").val();  //单据编号
	var billId = tr.find("input[id$=.billId]").val();  //单据id
	var lcNo = tr.find("a[id$=.lcNo]").text();  //信用证编号
	var lcWbId = tr.find("input[id$=.lcWbId]").val();
	var payBankName = tr.find("input[id$=.payBankName]").val();  //交、到单银行
	var payBankNo = tr.find("input[id$=.payBankNo]").val();  //交、到单银行
	var endDate = tr.find("input[id$=.endDate]").val();  //交、到单日期
	var currencyName = tr.find("input[id$=.currencyName]").val();  //币种
	var currencyNo = tr.find("input[id$=.currencyNo]").val();  //币种
	var billAmount = tr.find("input[id$=.billAmount]").val().excludeNotNumericDot(); //收、付款金额
	var payDate = tr.find("input[id$=.payDate]").val();  //预计付款日
	var supplierName = tr.find("input[id$=.supplierName]").val();  //供应商
	var description = tr.find("input[id$=.description]").val();  //货物描述
	var forexType = tr.find("input[id$=.forexType]").val();  //交单期类型
	var forexTypeName = tr.find("input[id$=.forexType]").parent().text();
	var lcAmount = tr.find("input[id$=.lcAmount]").val().excludeNotNumericDot();  //信用证金额
	var accBankName = tr.find("input[id$=.accBankName]").val(); // 开证行*/
	var lcDueDate = tr.find("input[id$=.lcDueDate]").val(); //信用证有效期
	
	var result = {};
	result.billNo = billNo;
	result.billId = billId;
	result.lcNo = lcNo;
	result.lcWbId = lcWbId;
	result.payBankName = payBankName;
	result.payBankNo = payBankNo;
	result.endDate = endDate;
	result.currencyName = currencyName;
	result.currencyNo = currencyNo;
	result.billAmount = billAmount;
	result.payDate = payDate;
	result.supplierName = supplierName;
	result.description = description;
	result.forexType = forexType;
	result.forexTypeName = forexTypeName;
	result.lcAmount = lcAmount;
	result.accBankName = accBankName;
	result.lcDueDate = lcDueDate;
	top.Layer.getWin().setSDBill(result);
	windowClose();
}

//展示票据信息
function showAccBillMsg(obj){
	var tr = $(nstc.sf.findParent(obj,"TR"));
	var wbId = tr.find("input[id$=.billId]").val();
	var url = "BMMS@showDraftInfoDetail.sf?m=v&wbId=" + wbId;
	openwin(url, '票据详情', 800, 500);
}
//选择票据贴现
function showBillDiscMsg(obj){
	var tr = $(nstc.sf.findParent(obj,"TR"));
	var wbId = tr.find("input[id$=.billId]").val();
	var url = "BMMS@showDraftInfoDetail.sf?m=v&wbId=" + wbId;
	openwin(url, '票据详情', 800, 500);
}

//展示信用证
function showLCBillMsg(obj){
	var tr = $(nstc.sf.findParent(obj,"TR"));
	var wbId = tr.find("input[id$=.billId]").val();
	var url = "BMMS@showILCDetail.sf?m=v&wbId=" + wbId;
	openwin(url, '信用证详情', 800, 500);
}

//展示保函证
function showLGBillMsg(obj){
	var tr = $(nstc.sf.findParent(obj,"TR"));
	var wbId = tr.find("input[id$=.billId]").val();
	var url = "BMMS@showLGDetail.sf?m=v&wbId=" + wbId;
	openwin(url, '保函证详情', 800, 500);
}
//展示单据
function showSDBillMsg(obj){
	var tr = $(nstc.sf.findParent(obj,"TR"));
	var wbId = tr.find("input[id$=.billId]").val();
	var url = "BMMS@showSDDetail.sf?m=v&wbId=" + wbId;
	openwin(url, '单据详情', 800, 500);
}
//显示单据上信用证详情
function showLCbill(obj){
	var tr = $(nstc.sf.findParent(obj,"TR"));
	var wbId = tr.find("input[id$=.lcWbId]").val();
	var url = "BMMS@showILCDetail.sf?m=v&wbId=" + wbId;
	openwin(url, '信用证详情', 800, 500);
}

//查询
function doQueryBill(obj, alertMsg){
	var minAmount = $('input[id$=_qry.minAmount]').val();
	var maxAmount = $('input[id$=_qry.maxAmount]').val();
	var txtMsg = "合同金额范围不合理";
	if(alertMsg){
		txtMsg = alertMsg + "范围不合理" ;
		var startDate = $('input[id$=_qry.startDate]').val();
        var endDate = $('input[id$=_qry.endDate]').val();
        if(startDate && endDate && !compareDate(startDate, endDate, '开证日期的起始日期不能大于结束日期')){
            return false;
        }
        var eStartDate = $('input[id$=_qry.e_startDate]').val();
        var eEndDate = $('input[id$=_qry.e_endDate]').val();
        if(eStartDate && eEndDate && !compareDate(eStartDate, eEndDate, '有效期的起始日期不能大于结束日期')){
            return false;
        }
	}
	if(!compareAmount(minAmount, maxAmount, txtMsg)){
		return;
	} 
	smartForm_doRefresh(obj)
}

function doQuerySDDBill(obj){
	var minAmount = $('input[id$=_qry.minAmount]').val();
	var maxAmount = $('input[id$=_qry.maxAmount]').val();
	if(!compareAmount(minAmount, maxAmount, '付款金额范围不合理')){
		return;
	} 
	var sEndDate = $('input[id$=_qry.sEndDate]').val();
	var eEndDate = $('input[id$=_qry.eEndDate]').val();
	if(!compareDate(sEndDate, eEndDate, '到单日期不合理')){
		return;
	}
	var sPayDate = $('input[id$=_qry.sPayDate]').val();
	var ePayDate = $('input[id$=_qry.ePayDate]').val();
	if(!compareDate(sPayDate, ePayDate, '预计付款日期不合理')){
		return;
	}
	smartForm_doRefresh(obj)
}
function doQuerySDJBill(obj){
	var minAmount = $('input[id$=_qry.minAmount]').val();
	var maxAmount = $('input[id$=_qry.maxAmount]').val();
	if(!compareAmount(minAmount, maxAmount, '收款金额范围不合理')){
		return;
	} 
	var sEndDate = $('input[id$=_qry.sEndDate]').val();
	var eEndDate = $('input[id$=_qry.eEndDate]').val();
	if(!compareDate(sEndDate, eEndDate, '交单日期不合理')){
		return;
	}
	var sPayDate = $('input[id$=_qry.sPayDate]').val();
	var ePayDate = $('input[id$=_qry.ePayDate]').val();
	if(!compareDate(sPayDate, ePayDate, '预计收款日期不合理')){
		return;
	}
	smartForm_doRefresh(obj)
}

//统计
function billInofCount() {
	var totalNumObj = $('input[id$="totalNum"]');
	var checkObj = $("[id$=._check]:checked");
	var totalAmount = 0;

	for(var i=0;i<checkObj.length;i++){
		var tr = $(nstc.sf.findParent(checkObj[i],"TR"));
		var billAmount = parseFloat(tr.find('input[id$=billAmount]').val().excludeNotNumericDot());
		totalAmount = accadd(totalAmount,billAmount);
	}
	var html = "总共<font color='red'>"+ totalNumObj.val() +"</font>张票据，"
				+"已选择<font color='red'>" + checkObj.length + "</font>张，"
				+"已选择金额合计：<font color='red'>" + (totalAmount == 0 ? "0.00" : FormatMoney(totalAmount,2)) + "</font>元";
	$('input[id$="totalNum"]').parent().html(html).append(totalNumObj);
}