$(function(){
	//动态显示授信品种
    var bussClass= $('select[id$=_qry.bussClass]').get(0);
    var bussVariety=$('select[id$=_qry.bussVariety]').get(0);
    queryBussVaresForCaInterest(bussClass,bussVariety);
});
// 选择单位
function selectNsClient(){
	var url = 'GDEBIT@gdt_nsClientSlt.sf';
	openwin(url, '单位列表', 500, 400);
}
function setNsclient(obj){
	$("input[id$=.cltNo]").val(obj.cltNo);
	$("input[id$=.cltName]").val(obj.cltName);
}

function doCacl(obj){
	var caclStartDate = $('input[id$=.caclStartDate]').val();
	var caclEndDate = $('input[id$=.caclEndDate]').val();
	var minAmount = $('input[id$=.minAmount]').val();
	var maxAmount = $('input[id$=.maxAmount]').val();
	if(!compareAmount(minAmount, maxAmount, '合同金额范围不合理')){
		return;
	} 
	if(caclStartDate == null || caclStartDate == ''){
		alert('测算开始日期不能为空');
		return;
	}
	if(caclEndDate == null || caclEndDate == ''){
		alert('测算结束日期不能为空');
		return;
	}
	if (dateDiff(caclStartDate, caclEndDate) <= 0) {
		alert("测算结束日必须大于测算开始日");
		return;
	}
	smartForm_doRefresh(obj);
}

//打开利息试算的页面
function openCalInterestDetail(obj){
	var formerBussId=$(obj).parents("tr");
	var fetchRegId=$(obj).parents("tr").find("input[id$='.fetchRegId']").val();
	
	var sDate=$("input[id$='gdt_caclInterest_qry.caclStartDate']").val();
	var eDate=$("input[id$='gdt_caclInterest_qry.caclEndDate']").val();
	var bussVariety = $(obj).parents("tr").find("input[id$='gdt_caclInterest_list.bussVarie']").val();
	//alert("bussVariety:"+bussVariety);
	
	if(bussVariety == 'CLMS28'){
		//window.open('GDEBIT@gdt_withhold_asset_detail.sf?m=v&fetchRegId='+fetchRegId+'&sDate='+sDate+'&eDate='+eDate, '预提明细', 'width=550, height=350');
		window.open('GDEBIT@gdt_cacllnterest_asset_detail.sf?m=v&fetchRegId='+fetchRegId+'&sDate='+sDate+'&eDate='+eDate, '利息试算明细', 'width=500, height=350');
	}else{
		//获取产品种类是否是资产证券化打开不同的页面
		window.open('GDEBIT@gdt_caclInterest_detail.sf?m=v&fetchRegId='+fetchRegId+'&sDate='+sDate+'&eDate='+eDate, '利息试算明细', 'width=500, height=350');	
	}
	
	//必需：打开窗口后设置openPage，避免在google中无法获取到父页面方法
	//window.openPage = "GDEBIT@gdt_cacllnterest_detail_list";
}