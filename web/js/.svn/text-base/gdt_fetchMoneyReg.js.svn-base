$(function (){
    //动态显示授信品种
    var bussClass= $('select[id$=_qry.bussClass]').get(0);
    var bussVariety=$('select[id$=_qry.bussVariety]').get(0);
    queryBussVaresForFetchMoney(bussClass,bussVariety);
    
    var list=$('table[id="gdt_fetchMoneyReg_list"]');
    $('div[id="div.gdt_fetchMoneyReg_del"]').hide();
	var trs=list.find("tbody tr:visible");
	for(var i=0;i<trs.length;i++){
		var note=$(trs[i]).find('input[id$="approveNote"]');
		var fetchApplyId = $(trs[i]).find('input[id$="fetchApplyId"]').val();
		if(note.val() != ''){
			$(trs[i]).css("background-color", "#FFC0CB");
		}
		if(fetchApplyId==undefined || fetchApplyId==''){
			$(trs[i]).find('a[id$="delApply"]').remove();
			$(trs[i]).find('a[id$="supInput"]').parent().attr("colspan","1");
		}else{
			$(trs[i]).find('a[id$="supInput"]').html("补录");
		}
	}
})

//选择金融合作网点
function selectAssBank(){
	var url = "GDEBIT@gdt_associateBankSlt.sf?isClear=1";
	openwin(url, '金融合作网点列表', 900, 500);
}

//选择 -- 金融合作网点
function setAssBank(obj){
	var assBankId= obj.assBankId;
	var assBankName= obj.assBankName;
	$("input[id$='_qry.assBankName']").val(assBankName);
	$("input[id$='_qry.assBankId']").val(assBankId);
}

function doQuery(obj){
	var minAmount = $('input[id$=.minAmount]').val();
	var maxAmount = $('input[id$=.maxAmount]').val();
	if(!compareAmount(minAmount, maxAmount, '合同金额范围不合理')){
		return;
	} 
	
	var minsDate = $('input[id$=minStartDate]').val();
	var maxsDate = $('input[id$=maxStartDate]').val();
	if(!compareDate(minsDate, maxsDate, '开始日期范围不合理')){
		return;
	}
	
	smartForm_doRefresh(obj);
}
function openAddFetchMoneyRegPage() {
	var url = "GDEBIT@gdt_addFetchMoneyReg.sf?m=e";
	openwin(url, '提款到账录入', 1200, 1000);
}
//选择某一个
function checkRec(obj){
	nstc.sf.clickCheckbox(obj);
}
//全选
function checkAll(obj){
	smartForm_all_checkbox(obj,'gdt_fetchMoneyReg_list._check');
}
function openFetchMoneyRegDetail(obj) {
	var tr = $(obj).parents("tr:first");
	var fmId = tr.find("input[id$=fmId]").val();
	var contractId = tr.find("input[id$=contractId]").val();
	var url = "GDEBIT@gdt_addFetchMoneyReg.sf?m=v&fmId=" + fmId + "&contractId=" + contractId;
	openwin(url, '提款到账详情', 1200, 1000);
}
function modifyFetchMoneyReg(obj) {
	var tr = $(obj).parents("tr:first");
	var fmId = tr.find("input[id$=fmId]").val();
	var contractId = tr.find("input[id$=contractId]").val();
	var url = "GDEBIT@gdt_addFetchMoneyReg.sf?m=e&fmId=" + fmId + "&contractId=" + contractId;
	openwin(url, '提款到账录入', 1200, 1000);
}
//选择某一个
function checkRec(obj){
	nstc.sf.clickCheckbox(obj);
	getCheckSize();
}
function getCheckSize(){
	var selectRecords = $("[id$=selectRecords]").val();
	var checkNum=getCheckNum();
	var selectRecordsHtml  = '<input id="selectRecords" name="selectRecords" type="hidden" value="'+selectRecords+'"/>'
	$("[id$=selectRecords]").parent().html("共计"+selectRecords+"笔，已选"+checkNum+"笔。"+selectRecordsHtml);
}
//全选
function checkAll(obj){
	smartForm_all_checkbox(obj,'gdt_fetchMoneyReg_list._check');
	getCheckSize();
}
//获取选中的行
function getCheckNum(){
	var checkObj = $("[id$=._check]:visible");
	var checkNum = 0;
	for ( var i = 0; i < checkObj.length; i++) {
		if (checkObj[i].checked) {
			checkNum++;
		}
	}
	return checkNum;
}
function doSubmit(obj) {
	var checks=$('input[id$="_check"]:checked');
	if(checks==undefined || checks.length==0){
		alert("至少选择一条数据");
		return;
	}
	smartForm_doSubmit(obj);
}
/**
 * 废弃申请
 * @param obj
 */
function doAbandoned(obj){
	var tr = $(obj).parent().parent("TR");
	var _check = $(tr).find("[id$='_check']")
	$(_check).click();
	checkRec(_check[0]);
	$(tr).css("background-color","#D0FDE4");
	var fetchNo = $(tr).find("input[id$='fetchNo']").val();
	$("[id$='div.gdt_fetchMoneyReg_del']").show();
	var form = document.getElementById("gdt_fetchMoneyReg_del");
	var title = $(form).find("[id$='gdt_fetchMoneyReg_del.titleId']");
	var str = '<span>提款号&nbsp&nbsp&nbsp'+fetchNo+'</span>';
	$(title).parent("TD").append(str);
}
function startAbandon(obj){
	var form = document.getElementById("gdt_fetchMoneyReg_del");
	var del = $("input[id='gdt_fetchMoneyReg_list.del']");
	var reason = $(form).find("[id='gdt_fetchMoneyReg_del.doDelReason']").val();
	if(reason==undefined||reason==''){
		alert("废弃原因不能为空");
		return;
	}
	doSubmit(obj);
}