$(function(){
	if($('input[id$="m"]').val()=='v'){
		//$('div[id$="_reason"]').hide();
		$('div[id$="_log"]').show();
		$('font').html('');
		$('select[id$="changeType_bak"]').val($('input[id$="changeType"]').val());
		$('input[id$="changeAmount_bak"]').val($('input[id$="changeAmount"]').val());
	}else{
		$('div[id$="_log"]').hide();
	}
});


function changeTypeAmount(obj){
	var tr = nstc.sf.findParent(obj, 'tr');
	var changeType = $(tr).find('select[id$=.changeType_bak]').val();
	var useAmount = $(tr).find('input[id$=.useAmount]').val();
	var gdtAmount= $(tr).find('input[id$=.gdtAmount]').val();
	var gdtChangeAmount = $(tr).find('input[id$=.gdtChangeAmount]');
	if(changeType == 2){
		//$(tr).find('input[id$=.changeAmount_bak]').val(useAmount).attr({"disabled":true});
		
		$(gdtChangeAmount).val(gdtAmount);
		$(gdtChangeAmount).attr("disabled","disabled");
		
		var gdt_rate = $(tr).find("input[id$='.gdt_rate']").val();
		//融资合同币种占用金额
		var gdtChangeAmount = gdtAmount;
		var changeAmountVal = FormatMoney(parseFloat(gdtChangeAmount.replace(/,/g,''))*parseFloat(gdt_rate),2);
		
		var changeAmount_bak = $(tr).find("input[id$='.changeAmount_bak']");
		$(changeAmount_bak).val(changeAmountVal);
		setInfo4InputAndSpan(tr,"changeAmount_bak",changeAmountVal,changeAmountVal);
	}else{
		//$(tr).find('input[id$=.changeAmount_bak]').val("").attr({"disabled":false});
		$(gdtChangeAmount).val("");
		$(gdtChangeAmount).removeAttr("disabled");
		
		var gdt_rate = $(tr).find("input[id$='.gdt_rate']").val();
		//融资合同币种占用金额
		var gdtChangeAmount = gdtAmount;
		var changeAmountVal = FormatMoney(parseFloat(gdtChangeAmount.replace(/,/g,''))*parseFloat(gdt_rate),2);
		
		var changeAmount_bak = $(tr).find("input[id$='.changeAmount_bak']");
		$(changeAmount_bak).val(changeAmountVal);
		setInfo4InputAndSpan(tr,"changeAmount_bak","","");
	}
}


function doSubmit(obj){
	var changeType = $('select[id$="changeType_bak"]').val();
	var changeAmount = $('input[id$="changeAmount_bak"]').val();
	//追加占用
//	if(changeType == 0){
//		var creditBalance = $('input[id$="creditBalance"]').val().excludeNotNumericDot();
//		if(parseFloat(changeAmount)>parseFloat(useAmount)){
//			alert('品种额度不足，占用额度为：'+$('input[id$="useAmount"]').val());
//			return;
//		}
//	}
	//释放
	if(changeType == 1){
		var useAmount=$('input[id$="useAmount"]').val().excludeNotNumericDot();
		var changeAmount=$('input[id$="changeAmount_bak"]').val().excludeNotNumericDot();
		if(parseFloat(changeAmount)>parseFloat(useAmount)){
			alert('释放额度大于占用额度，占用额度为：'+$('input[id$="useAmount"]').val());
			return;
		}
	}
	
	$("input[id$='.changeType']").val(changeType);
	$("input[id$='.changeAmount']").val(changeAmount);
	$("input[id$='.gdtChangeAmount']").removeAttr("disabled");
	
	smartForm_doSave(obj);
}



//点击确定操作
function smartForm_confirm_true(){
	//$("#父窗口元素ID",window.parent.document);
	var objbut = top.Layer.getWin().document.getElementById("gdt_creditChange_qry.refresh");
	var objbut2 = top.Layer.getWin().document.getElementById("gdt_creditChangeWait_qry.refresh");
	if(objbut){
		objbut.click();
		windowClose();
	}
	if(objbut2){
		objbut2.click();
		windowClose();
	}
}
function smartForm_confirm(msg) {
	alert(msg);
    smartForm_confirm_true();
}

//查看授信合同
function showCredit(obj){
	var tr = nstc.sf.findParent(obj, "TR");
	var creditContractId = $(tr).find("input[id$='.creditContractId']").val();
	var url = 'CLMS-Web@clms_creditContractEntry.sf?m=v&contractId=' + creditContractId;
	openwin(url, '授信合同详情', 900, 600);
}
function setGdtChangeAmount(obj){
	var tr = $(nstc.sf.findParent(obj, "TR"));
	//汇率
	var gdt_rate = $(tr).find("input[id$='.gdt_rate']").val();
	//融资合同币种占用金额
	var gdtChangeAmount = $(obj).val();
	var changeAmountVal = FormatMoney(parseFloat(gdtChangeAmount.replace(/,/g,''))*parseFloat(gdt_rate),2);
	
	var changeAmount_bak = $(tr).find("input[id$='.changeAmount_bak']");
	$(changeAmount_bak).val(changeAmountVal);
	setInfo4InputAndSpan(tr,"changeAmount_bak",changeAmountVal,changeAmountVal);
//	checkUseAmount(useAmount);
}